<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body>
  <div id="root" />
  <script type="module" src="/src/index.tsx"></script>
  <script>
    const displayedFiles = [];
    const texts = [];

    async function pollFileIndex() {
      try {
        const cacheBusting = new Date().getTime();
        const filesResult = await fetch(`/output/fileindex.txt?_=${cacheBusting}`);
        const files = (await filesResult.text()).split("\n").filter(Boolean); // Filter out empty lines

        for (const filename of files) {
          if (!displayedFiles.includes(filename)) {
            try {
              const fileResult = await fetch(`/output/${filename}`);
              const fileText = await fileResult.text();

              window.appendContents({
                appendContents: fileText
              });

              displayedFiles.push(filename);
            } catch (err) {
              console.error(`Failed to fetch file ${filename}:`, err);
              // Optionally, inform the user or take other actions
            }
          }
        }
      } catch (err) {
        console.error('Failed to fetch fileindex.txt:', err);
        // Optionally, inform the user or take other actions
      }
      setTimeout(pollFileIndex, 1000);
    }
    window.addEventListener('load', async () => {
      window.setContents({
        initialContents: ""
      });
      await pollFileIndex()
    });
  </script>
</body>

</html>